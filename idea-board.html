<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Idea Board</title>
    
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/1024/1024507.png">
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* [ëª¨ë°”ì¼ ìµœì í™”] ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì„¤ì • */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root {
            --bg-primary: #f8f6f1; --bg-secondary: #fffef9; --text-primary: #2a2a2a;
            --text-secondary: #6a6a6a; --accent-sage: #9caf88; --shadow-soft: rgba(0,0,0,0.08);
        }
        body {
            font-family: 'Pretendard', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            touch-action: none; /* ëª¨ë°”ì¼ì—ì„œ ë¸Œë¼ìš°ì € ê¸°ë³¸ ìŠ¤í¬ë¡¤ ë§‰ê¸° */
        }
        
        /* ìƒë‹¨ ë°” */
        .top-bar {
            position: absolute; top: 0; left: 0; right: 0; height: 60px;
            background: rgba(248, 246, 241, 0.95); backdrop-filter: blur(10px);
            display: flex; align-items: center; padding: 0 20px; gap: 10px; z-index: 900;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .logo { font-weight: 700; font-size: 1.1rem; flex-shrink: 0; }
        
        /* ê²€ìƒ‰ì°½: ëª¨ë°”ì¼ì—ì„œëŠ” ì‘ê²Œ, PCì—ì„œëŠ” ë„“ê²Œ */
        .search-box { flex: 1; max-width: 400px; position: relative; }
        .search-input {
            width: 100%; padding: 10px 15px 10px 35px;
            border: 1px solid #ddd; border-radius: 20px; font-size: 16px; /* 16pxì—¬ì•¼ ì•„ì´í° í™•ëŒ€ ì•ˆë¨ */
        }
        .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; }

        /* ìº”ë²„ìŠ¤ ì˜ì—­ */
        .canvas { width: 100%; height: 100%; position: relative; cursor: grab; }
        .canvas:active { cursor: grabbing; }
        
        /* ë…¸íŠ¸ ìŠ¤íƒ€ì¼ */
        .note-node { position: absolute; touch-action: none; user-select: none; }
        .note-card {
            background: var(--bg-secondary); border-radius: 16px; padding: 16px 20px;
            box-shadow: 0 4px 15px var(--shadow-soft); border: 1px solid rgba(0,0,0,0.05);
            display: flex; flex-direction: column; width: 100%; height: 100%;
            transition: transform 0.2s;
        }
        /* ëª¨ë°”ì¼ í„°ì¹˜ ì˜ì—­ í™•ë³´ë¥¼ ìœ„í•´ ë²„íŠ¼ í¬ê¸° í™•ëŒ€ */
        .note-delete {
            position: absolute; top: -10px; right: -10px; width: 36px; height: 36px;
            background: white; border-radius: 50%; box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            display: flex; align-items: center; justify-content: center; color: #ff4757;
            font-weight: bold; border: none; font-size: 1.2rem; z-index: 10;
        }

        /* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ ë°” */
        .controls {
            position: fixed; bottom: 30px; right: 20px; display: flex; gap: 15px; z-index: 1000;
        }
        .control-btn {
            width: 56px; height: 56px; border-radius: 50%; border: none;
            background: white; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-size: 1.5rem; display: flex; align-items: center; justify-content: center;
        }
        .control-btn.add { background: var(--accent-sage); color: white; width: 64px; height: 64px; }

        /* ëª¨ë‹¬ (íŒì—…) ìŠ¤íƒ€ì¼ */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); z-index: 2000;
            display: flex; align-items: center; justify-content: center;
        }
        .modal-content {
            background: white; width: 90%; max-width: 500px; border-radius: 20px;
            padding: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            position: relative; max-height: 80vh; overflow-y: auto;
        }
        .modal-close {
            position: absolute; top: 15px; right: 15px; background: none; border: none;
            font-size: 1.5rem; padding: 10px;
        }

        /* [ëª¨ë°”ì¼ ë°˜ì‘í˜• ë¯¸ë””ì–´ ì¿¼ë¦¬] */
        @media (max-width: 768px) {
            .logo { font-size: 1rem; }
            .top-bar { padding: 0 15px; }
            .controls { bottom: 20px; right: 15px; gap: 10px; }
            .control-btn { width: 50px; height: 50px; }
            .note-preview { font-size: 1rem; line-height: 1.5; } /* ê¸€ì”¨ í‚¤ì›€ */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ì´ˆê¸° ë°ì´í„°
        const INITIAL_NOTES = [
            { id: 1, content: '#ì•„ì´ë””ì–´ ğŸ’¡\ní„°ì¹˜í•´ì„œ ë“œë˜ê·¸í•´ë³´ì„¸ìš”!', x: 150, y: 150, width: 260, height: 180, color: 'sage', createdAt: new Date() },
            { id: 2, content: 'ëª¨ë°”ì¼ì—ì„œë„\nì˜ ì‘ë™í•©ë‹ˆë‹¤ ğŸ“±', x: 450, y: 300, width: 260, height: 180, color: 'terracotta', createdAt: new Date() }
        ];

        function IdeaBoard() {
            const [notes, setNotes] = useState(() => {
                const saved = localStorage.getItem('ideaBoardNotes');
                return saved ? JSON.parse(saved) : INITIAL_NOTES;
            });
            
            const [scale, setScale] = useState(1);
            const [position, setPosition] = useState({ x: 0, y: 0 });
            
            // ë“œë˜ê·¸ ìƒíƒœ ê´€ë¦¬ (ë§ˆìš°ìŠ¤+í„°ì¹˜ í†µí•©)
            const [dragState, setDragState] = useState({ 
                isDragging: false, 
                targetId: null, // nullì´ë©´ ìº”ë²„ìŠ¤ ì „ì²´ ë“œë˜ê·¸
                startX: 0, startY: 0, 
                initialX: 0, initialY: 0 // ë“œë˜ê·¸ ì‹œì‘ ì‹œì ì˜ ëŒ€ìƒ ìœ„ì¹˜
            });

            const [modalNote, setModalNote] = useState(null);
            const [isCreating, setIsCreating] = useState(false);
            const [newNoteContent, setNewNoteContent] = useState('');

            useEffect(() => {
                localStorage.setItem('ideaBoardNotes', JSON.stringify(notes));
            }, [notes]);

            // [í•µì‹¬] ì¢Œí‘œ ì •ê·œí™” í•¨ìˆ˜ (ë§ˆìš°ìŠ¤/í„°ì¹˜ ì¢Œí‘œë¥¼ í†µì¼)
            const getClientCoords = (e) => {
                if (e.touches && e.touches.length > 0) {
                    return { x: e.touches[0].clientX, y: e.touches[0].clientY };
                }
                return { x: e.clientX, y: e.clientY };
            };

            // ë“œë˜ê·¸ ì‹œì‘ (í†µí•©)
            const handleStart = (e, noteId = null) => {
                // ì…ë ¥ í•„ë“œë‚˜ ë²„íŠ¼ í´ë¦­ ì‹œ ë“œë˜ê·¸ ë°©ì§€
                if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                
                const coords = getClientCoords(e);
                let initial = { x: position.x, y: position.y };

                if (noteId) {
                    e.stopPropagation(); // ë…¸íŠ¸ ë“œë˜ê·¸ ì‹œ ìº”ë²„ìŠ¤ ì´ë™ ë°©ì§€
                    const note = notes.find(n => n.id === noteId);
                    initial = { x: note.x, y: note.y };
                }

                setDragState({
                    isDragging: true,
                    targetId: noteId,
                    startX: coords.x,
                    startY: coords.y,
                    initialX: initial.x,
                    initialY: initial.y
                });
            };

            // ë“œë˜ê·¸ ì¤‘ (í†µí•©)
            const handleMove = (e) => {
                if (!dragState.isDragging) return;
                
                // í„°ì¹˜ ìŠ¤í¬ë¡¤ ë°©ì§€
                if (e.cancelable) e.preventDefault(); 
                
                const coords = getClientCoords(e);
                const dx = coords.x - dragState.startX;
                const dy = coords.y - dragState.startY;

                if (dragState.targetId) {
                    // ë…¸íŠ¸ ì´ë™
                    setNotes(prev => prev.map(n => 
                        n.id === dragState.targetId 
                        ? { ...n, x: dragState.initialX + dx / scale, y: dragState.initialY + dy / scale } 
                        : n
                    ));
                } else {
                    // ìº”ë²„ìŠ¤ íŒ¨ë‹ (ì´ë™)
                    setPosition({
                        x: dragState.initialX + dx,
                        y: dragState.initialY + dy
                    });
                }
            };

            // ë“œë˜ê·¸ ì¢…ë£Œ
            const handleEnd = () => {
                setDragState(prev => ({ ...prev, isDragging: false, targetId: null }));
            };

            // ë…¸íŠ¸ ìƒì„±
            const addNote = () => {
                if (!newNoteContent.trim()) return;
                const newNote = {
                    id: Date.now(),
                    content: newNoteContent,
                    x: (-position.x + window.innerWidth / 2) / scale - 130, // í™”ë©´ ì¤‘ì•™
                    y: (-position.y + window.innerHeight / 2) / scale - 90,
                    width: 260, height: 180,
                    color: 'sage',
                    createdAt: new Date()
                };
                setNotes([...notes, newNote]);
                setNewNoteContent('');
                setIsCreating(false);
            };

            // ë…¸íŠ¸ ì‚­ì œ
            const deleteNote = (id, e) => {
                e.stopPropagation();
                if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    setNotes(notes.filter(n => n.id !== id));
                    setModalNote(null);
                }
            };

            return (
                <div 
                    className="app-container"
                    onMouseDown={(e) => handleStart(e, null)}
                    onTouchStart={(e) => handleStart(e, null)}
                    onMouseMove={handleMove}
                    onTouchMove={handleMove}
                    onMouseUp={handleEnd}
                    onTouchEnd={handleEnd}
                >
                    {/* ìƒë‹¨ ë°” */}
                    <div className="top-bar">
                        <div className="logo">ğŸ’¡ Idea</div>
                        <div className="search-box">
                            <input type="text" className="search-input" placeholder="ê²€ìƒ‰..." />
                            <span className="search-icon">ğŸ”</span>
                        </div>
                    </div>

                    {/* ìº”ë²„ìŠ¤ */}
                    <div className="canvas">
                        <div style={{ transform: `translate(${position.x}px, ${position.y}px) scale(${scale})`, transformOrigin: '0 0', width: '100%', height: '100%' }}>
                            {notes.map(note => (
                                <div
                                    key={note.id}
                                    className="note-node"
                                    style={{ left: note.x, top: note.y, width: note.width, height: note.height }}
                                    onMouseDown={(e) => handleStart(e, note.id)}
                                    onTouchStart={(e) => handleStart(e, note.id)}
                                    onClick={() => setDragState(prev => !prev.isDragging && setModalNote(note))} // ë“œë˜ê·¸ê°€ ì•„ë‹ ë•Œë§Œ í´ë¦­
                                >
                                    <div className="note-card">
                                        <button className="note-delete" onClick={(e) => deleteNote(note.id, e)}>Ã—</button>
                                        <div style={{ whiteSpace: 'pre-wrap', fontSize: '1.1rem', lineHeight: '1.5' }}>
                                            {note.content.length > 30 ? note.content.substring(0, 30) + '...' : note.content}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ */}
                    <div className="controls">
                        <button className="control-btn" onClick={() => setPosition({x:0, y:0})}>ğŸ </button>
                        <button className="control-btn add" onClick={() => setIsCreating(true)}>+</button>
                    </div>

                    {/* ì‘ì„± ëª¨ë‹¬ */}
                    {isCreating && (
                        <div className="modal-overlay" onClick={() => setIsCreating(false)}>
                            <div className="modal-content" onClick={e => e.stopPropagation()}>
                                <h2 style={{marginBottom:'15px'}}>ìƒˆë¡œìš´ ì•„ì´ë””ì–´</h2>
                                <textarea 
                                    style={{width:'100%', height:'150px', padding:'10px', fontSize:'16px', borderRadius:'10px', border:'1px solid #ddd'}}
                                    value={newNoteContent}
                                    onChange={e => setNewNoteContent(e.target.value)}
                                    placeholder="ë¬´ìŠ¨ ìƒê°ì„ í•˜ê³  ê³„ì‹ ê°€ìš”?"
                                    autoFocus
                                />
                                <div style={{display:'flex', gap:'10px', marginTop:'15px'}}>
                                    <button onClick={() => setIsCreating(false)} style={{flex:1, padding:'12px', border:'none', borderRadius:'8px'}}>ì·¨ì†Œ</button>
                                    <button onClick={addNote} style={{flex:1, padding:'12px', background:'#9caf88', color:'white', border:'none', borderRadius:'8px'}}>ë“±ë¡</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<IdeaBoard />);
    </script>
</body>
</html>
